<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.1.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://example.com/blog/neovim-macros-vs-registers/"><!-- Primary Meta Tags --><title>Neovim macros vs normal mode</title><meta name="title" content="Neovim macros vs normal mode"><meta name="description" content="Lorem ipsum dolor sit amet"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://example.com/blog/neovim-macros-vs-registers/"><meta property="og:title" content="Neovim macros vs normal mode"><meta property="og:description" content="Lorem ipsum dolor sit amet"><meta property="og:image" content="https://example.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://example.com/blog/neovim-macros-vs-registers/"><meta property="twitter:title" content="Neovim macros vs normal mode"><meta property="twitter:description" content="Lorem ipsum dolor sit amet"><meta property="twitter:image" content="https://example.com/blog-placeholder-1.jpg"><link rel="stylesheet" href="/_astro/about.j1O9B2HW.css" />
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}
</style>
<link rel="stylesheet" href="/_astro/about.dt1nw-bf.css" /></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Aaron&#39;s Blog</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/blog" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blog </a>  <a href="/about" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> About </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-3ef6ksr2></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> </div> </nav> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo> <img width="1020" height="510" src="/blog-placeholder-2.jpg" alt="Neovim macros vs normal mode" data-astro-cid-bvzihdzo> </div> <div class="tags" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2023-12-19T05:00:00.000Z"> Dec 19, 2023 </time>  </div> <h1 data-astro-cid-bvzihdzo>Neovim macros vs normal mode</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>In neovim, which is better, <strong>macros</strong> or <strong>normal</strong> mode? You may be suprised
at the power of normal mode and the <strong>execute</strong> command, compared to
managing macros with plugins.</p>
<ol>
<li>
<p>If normal mode can perform the same job as macros, then where would you use
macros? Probably when you have to do the same edit in multiple places, but these
places don’t follow any pattern, and the same could be accomplished by
assigning the search register and using execute to trigger <code>n</code> in normal mode.</p>
</li>
<li>
<p>You get to write normal commands live, while looking at the code, rather than
try to decipher a dense string of characters that doesn’t make sense in an
editable list format, without the original context. I would say its better to get good at vim motions and be
prepared to write them at-will rather than spend time writing and organazing
macros.</p>
</li>
<li>
<p>It’s better to use <code>fFtT</code> and <code>hjkl</code> than <code>wb</code>, since targeting the beginning
of a word is recognizable in command form than contextual word navigation.</p>
</li>
<li>
<p>Recording macros often requires multiple tries, which distracts you from whatever youre working on.
You won’t be able to immediately use the macro, since you will have to go back and edit it.
It’s better to just write the normal mode command and use it immediately.
Then type <code>let @q=&#39;&lt;C-R&gt;q&#39;</code> and then edit the macro inside the quotes. I think it’s better than polluting your buffers.</p>
</li>
<li>
<p>You made 4 good macros, but you forgot what they do and decyphering letters
takes more time than to just not use the macro? Here is a neet little trick.
Just before you are about to finish the macro, add a comment in command line
like so: <code>qqiHello World&lt;C-\[&gt;:&quot; Print Hello World to the buffer&lt;CR&gt;q</code>. This
will show in the <code>:reg</code> output, so it’s very handy. Just make sure you DON’T
make a mistake when typing the message or you will have to redo the point 3
(with double slaps).</p>
</li>
</ol>
<p>For example, in my [Wezterm] config, I wanted to see if I could replace
all instead of <code>a.[Wezterm method]</code> with <code>act.[Wezterm method]</code>, where a Wezterm
method is a command available in the wezterm action API, like
<code>wezterm.action.SendKey</code> or <code>wezterm.action.SplitHorizontal</code>. I could have used
find and replace with a regex string, like <code>%s/act.[A-Z+]/a.[A-Z+]/g</code>, but to
help solve the normal mode debate, I tried doing this with a normal mode
command.</p>
<ol>
<li>
<p>First, I set the “find” register (<code>@\</code>) to my search string:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span> a.[A-Z*]</span></span></code></pre>
</li>
<li>
<p>Then I ran this command:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">171</span><span style="color:#E1E4E8">,$norm nlact^[</span><span style="color:#9ECBFF">"</span></span></code></pre>
</li>
<li>
<p>Result: <code>a.AdjustPanelSize</code> and <code>a.ActivePaneDirection</code> have been
updated to have a prefix of <code>act.</code> instead of <code>a.</code>, as well as any other
methods that started with <code>act.</code>. Now, the variable <code>a</code> can be deleted.</p>
</li>
</ol>
<p>However, it is not easy to deal with the escape characters, and the command is
not very readable. A better solution is to use the <code>execute</code> command:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">execute</span><span style="color:#9ECBFF"> "159,165norm 0fc2dw"</span></span></code></pre>
<p>This command means, if the cursor was directly below the <code>*</code> character below, running <code>:execute &quot;2,4norm fc2dw&quot;</code> would move the cursor to the <code>c</code> in <code>config</code> on line 2, and delete the word
<code>config</code> on lines 2, 3, and 4.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">  *</span><span style="color:#E1E4E8"> config.</span><span style="color:#B392F0">a</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    config.</span><span style="color:#B392F0">b</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    config.</span><span style="color:#B392F0">c</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span></code></pre>
<p><em><strong>into</strong></em></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{a </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">,b </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">,c </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">}</span></span></code></pre>
<p>In Neovim, macros are stored as their actual commands, and in order to add a
description to them, a plugin is needed. This turned out to be more tricky than
I had expected, as this is a case when the most popular plugins on github are
actually not to be recommended. The first result, <a href="https://github.com/ecthelionvi/NeoComposer.nvim">NeoComposer</a>,
made little sense to use unless you always kept your macro list to at most 7 macros and you are able to easily decipher all of them.
(macros are displayed as virtual text and you can “scroll” through the macros
via <code>&lt;C-n&gt;</code> and <code>&lt;C-p&gt;</code>.</p>
<p>I considered forking the project but I knew my macro collection would be big
enough to require searching. The next most popular plugin was <a href="https://github.com/svermeulen/vim-macrobatics">Macrobatics</a>,
which looked to be exactly what I wanted, but I had this need for everything to be
using the neovim lua api, and not direct vim commands, and actually the plugin
just did not work on my machine, so I searched github until i found one that
actually worked well &amp;mdash <a href="https://github.com">telescope-macros</a>. Adding a
telescope finder is a clever and simple solution and I applaud the author &amp;mdash
an editable list is the only thing needed to manage a macro library.</p>
<p>If I have a macro assigned to the <code>@l</code> register, using <code>telescope-macros</code>, I
can apply it repeatedly via <code>&lt;leader&gt;ml&lt;cr&gt;</code>: <code>&lt;leader&gt;m</code> opens the telescope
macros list, <code>l</code> finds the macro under the <code>@l</code> register, and <code>&lt;cr&gt;</code> closes the
window and applies the macro.</p>
<p>I felt some modifications were essential to make - for instance, adding a key
binding to [[☆ Telescope keymap]] that would close the modal and navigate to
the previewed file. Why isn’t that part of telescope by default? I searched for
examples and found none other than [[ThePrimeagen]]‘s telescope
modifications, and I took his <code>get_preview</code> function, which would open the
buffer from the preview window in the editor.</p>
<p>However, his function didn’t work and I punted on the idea after trying and
failing to get AI to help. Later on, I actually found Google Duet to be the most
proficient as writing neovim functions.</p>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2024 Aaron Lifton. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/mastodon" data-astro-cid-sz7xmlte><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>