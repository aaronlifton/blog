---
import { PAGE_SIZE } from "$/consts";
import TagPage from "$components/TagPage.astro";
import { getTags, getAllPosts } from "$/services/blog.ts"
export const prerender = true;

export async function getStaticPaths() {
  const posts = await getAllPosts();
  const tags = await getTags();

  return tags.map((tag) => {
    const postsWithTag = posts.filter((post) => post.data.tags.includes(tag));
    return {
      params: {
        tag,
      },
      props: {
        posts: postsWithTag,
      },
    };
  });
}

type Props = { posts: any[]; };
type Params = { tag: string; }
const { posts } = Astro.props as Props;
const { tag } = Astro.params as Params;
const page = { 
  currentPage: 1,
  lastPage: Math.ceil(posts.length / PAGE_SIZE),
  data: posts.slice(0, PAGE_SIZE),
}
---

<TagPage tag={tag} page={page} />
